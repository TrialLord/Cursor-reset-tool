name: Cursor Reset Tool CI/CD

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # Allow manual triggering

permissions:
  contents: write  # Required for creating releases and deploying pages

jobs:
  test-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Test PowerShell Script
      shell: pwsh
      run: |
        # Test script syntax
        $scriptContent = Get-Content cursor_reset.ps1 -Raw
        $null = [System.Management.Automation.PSParser]::Tokenize($scriptContent, [ref]$null)
        Write-Output "Script syntax is valid"

  test-macos:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Test Bash Script
      run: |
        # Make script executable
        chmod +x cursor_reset_mac.sh
        # Test script syntax
        bash -n cursor_reset_mac.sh

  deploy-pages:
    needs: [test-windows, test-macos]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs
        publish_branch: gh-pages

  release:
    needs: [test-windows, test-macos]
    if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Required for creating releases
    steps:
    - uses: actions/checkout@v4
    
    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        name: Release ${{ github.sha }}
        tag_name: v${{ github.run_number }}
        draft: false
        prerelease: false
        files: |
          cursor_reset.ps1
          cursor_reset_mac.sh
          run_as_admin.bat
          README.md
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 